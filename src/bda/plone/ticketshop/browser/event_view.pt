<!--
  XXX: create package plone.app.eventviews or similar
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="bda.plone.ticketshop">

<body>

  <metal:content-core fill-slot="content-core">
    <metal:block define-macro="content-core">
      <tal:def tal:define="data nocall:view/data">

        <div class="event_property"
             tal:condition="data/subjects"
             i18n:domain="plone.app.event">
          <strong i18n:translate="event_what">What</strong>
          <ul>
            <li itemprop="eventType"
                class="category"
                tal:repeat="item data/subjects"
                tal:content="item" />
          </ul>
        </div>

        <div class="event_property"
             i18n:domain="plone.app.event">
          <strong i18n:translate="event_when">When</strong>
          <div tal:define="start_tzname data/timezone;
                           start_utcdelta python:data.start.tzinfo.utcoffset(data.start);
                           start_utcoffset python:(start_utcdelta.days*86400+start_utcdelta.seconds)*100/60/60;">
            <tal:date replace="structure python:view.formated_date(context)" />
            <span class="timezone" tal:condition="start_tzname">
              (<tal:tzname replace="start_tzname">timezone name</tal:tzname> / UTC<tal:tzoffset replace="start_utcoffset" />)
            </span>
          </div>
        </div>

        <div class="event_property"
             tal:define="location view/get_location"
             tal:condition="location"
             i18n:domain="plone.app.event">
          <strong i18n:translate="event_where">Where</strong>
          <span itemprop="location" class="location"
              tal:content="structure location">
            Location
          </span>
        </div>

        <div class="event_property"
             tal:define="contact_email data/contact_email;
                         contact_name data/contact_name;"
             tal:condition="python:contact_name or contact_email"
             i18n:domain="plone.app.event">
          <strong i18n:translate="contact_name">Contact Name</strong>
          <div>
            <a tal:condition="contact_email"
               tal:content="structure python: context.spamProtect(mailaddress=contact_email, mailname=contact_name, cssclass='email fn')">
               email
            </a>
            <span class="fn"
                  tal:condition="not: contact_email"
                  tal:content="contact_name" />
          </div>
        </div>

        <div class="event_property"
             tal:condition="data/contact_phone"
             i18n:domain="plone.app.event">
          <strong i18n:translate="contact_phone">Contact Phone</strong>
          <span class="tel" tal:content="data/contact_phone">
              Contact Phone
          </span>
        </div>

        <div class="event_property"
             tal:condition="data/attendees|nothing"
             i18n:domain="plone.app.event">
          <strong i18n:translate="contact_attendees">Attendees</strong>
          <div class="attendees">
            <ul>
              <li itemprop="attendee" class="attendee"
                  tal:repeat="item data/attendees"
                  tal:content="item" />
            </ul>
          </div>
        </div>

        <div class="event_property"
             tal:condition="data/event_url"
             i18n:domain="plone.app.event">
          <strong i18n:translate="event_url">Web</strong>
          <span class="url">
            <a href="" tal:attributes="href data/event_url">
              <span i18n:translate="external_website">Visit external website</span>
            </a>
          </span>
        </div>

        <div class="event_property"
             i18n:domain="plone.app.event">
          <strong i18n:translate="heading_add_to_calendar">Add event to calendar</strong>
          <span tal:define="here_url context/@@plone_context_state/object_url;
                            portal_url context/@@plone_portal_state/portal_url;">
            <a href="#"
               tal:attributes="href string:$here_url/ics_view"
               title="Download this event in iCal format"
               i18n:attributes="title title_add_to_ical;">
              <img src="" alt=""
                  tal:attributes="src string:${portal_url}/++resource++plone.app.event/icon_export_ical.png"/>
              <span i18n:translate="label_add_to_ical">iCal</span></a>
          </span>
        </div>

      </tal:def>
    </metal:block>
  </metal:content-core>

</body>

</html>
